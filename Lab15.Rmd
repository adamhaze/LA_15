---
title: "Lab 15 (FINAL LAB)"
author: "Adam Hayes, Erin Omyer, Richard Park, Jasmine Sanchez"
date: "5/1/2019"
output: html_document
---

```{r setup, include=FALSE, }
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```



###How does state income impact state education overall?
Our team, the Alge-Bros and Inte-Girls, was recently hired by the Secretary of Education, who will be our domain expert for this project. The Secretary of Education has asked us to analyze how state income affects education overall. 


###Importance
This is an important question to analyze because it will be a good indicator for the Secretary of Education to see how effective money is being used for education at the state level.

###Our Data
https://www.kaggle.com/noriuk/us-education-datasets-unification-project

The data our team decided to use came from the kaggle site posted above. We chose this dataset primarily because it gives insightful and relevant data with regards to nationwide education. More importantly, it serves as an economic underpinning so we can analyze different statistics about how effectively money is being spent on education. This dataset will have extensive value because it breaks each component down to the state-level, allowing us to go more in depth with state incomes instead of a national income.

###Conclusion


###Recommendations

```{r}
library(tidyverse)
library(modelr)
options(na.action = na.warn)


education <- read.csv("states_all.csv") %>%
  select(-PRIMARY_KEY)%>%
  group_by(YEAR)
education <- education[!is.na(education$ENROLL),]%>%
  mutate(meanEnroll = mean(ENROLL),
         meanRevenue = mean(TOTAL_REVENUE))
mod <- lm(meanEnroll~YEAR*meanRevenue, data = education)
grid <- education %>%
  data_grid(meanRevenue)
grid <- grid %>%
  add_predictions(mod)

ggplot(education, aes(x=YEAR, y = meanRevenue))+
  geom_line()+
  labs(title = "Average Revenue for all States by Year")

ggplot(education, aes(YEAR))+
  geom_point(aes(y = meanEnroll))+
  geom_line(aes(y = pred),data = grid, size = 1)+
  ggtitle("Model for Average # of Enrolled Students vs Yearly Revenue,\ncompared with Actual Values for all states by Year")
  

```


###Adam's Findings

```{r}
dataAdam <- education %>%
  filter(YEAR==2013)%>%
  arrange(desc(TOTAL_REVENUE))
```

###Erin's Findings

####Does the total revenue for education follow the year? (i.e Does the year matter?)

```{r}
educationERIN <- read.csv("states_all.csv") %>%
  select(-PRIMARY_KEY)
education <- education[!is.na(education$TOTAL_REVENUE),]

enrolled <- education[!is.na(education$ENROLL),]

dataErin <- education %>%
  select(YEAR,TOTAL_REVENUE)

median1993_E <- education %>%
  filter(YEAR == 1993) %>%
  summarise(median1993 = median(dataErin$TOTAL_REVENUE))

median2016_E <- education %>%
  filter(YEAR == 2016)%>%
  summarise(median2016 = mean(dataErin$TOTAL_REVENUE))

testgroup <- education %>%
  filter(YEAR == 1993 || YEAR == 2016)

perm_median <- function(perms = 1000, values, n1)
{
  # Create vector of zeroes of length "perms" to store
  # permuted mean differnces
  outputMedian <- c()
  
  # Loop throught number of permutations
  for (i in c(1:perms))
  {
    # Randomly separate vector "values" into disjoint 
    # groups of size "n1" and "length(values) - n1" respectively
    
    vector1 <- sample(values, n1)
    n2 <- length(values)-n1
    vector2 <- sample(values, n2)
    
    # Compute the sample means for the two groups from 
    # step 2
    
    firstMedian <- median(vector1)
    secondMedian <- median(vector2)
    
    # Compute the difference in sample means, store the
    # value in the vector from step 1
    
    medianDifference <- firstMedian - secondMedian
    
    outputMedian[i] <- medianDifference
  }
  # Return new updated vector, created in step 1
  
  return(outputMedian)
}

revDifference <- median2016_E - median1993_E

results <- perm_median(1000, dataErin$TOTAL_REVENUE, 1000)
resultss <- abs(results)

ggplot()+
  geom_histogram(aes(x=resultss),fill = "pink")+
  geom_vline(xintercept = 200000)+
  stat_bin(binwidth = 300) +
  labs(title = "Distribution of Difference in Medians for 1993 and 2016 in Total Revenue")+
  xlab("Difference")

resultERIN <- sum(resultss<200000)
percentiles_data1 <- resultERIN/1000

```
```{r echo = FALSE, results = 'asis'}
library(knitr)
kable(revDifference, caption = "The actual difference between 1993 and 2016")
```
```{r echo = FALSE, results = 'asis'}
library(knitr)
kable(percentiles_data1, caption = "The percentiles of difference in medians")
```
  
####Comments

From 1993 to 2016, there has been a vast change in the way the education system functions in the United States. Not only have the number of students have increased, the number of teachers and the amount of money fluctuating in the system. We conducted a permutation test on the median total revenue for the year 1993 and 2016. From the graph above, the total revenue between years has tried to remain relatively the same with minimal states with vast variations. Through the permutation test, we found a percentile difference to contain roughly 0.3 percent of the data. This number is a small proportion of the data, which means the years do matter when looking at total revenue from 1993 to 2016.The difference between 1993 and 2016 for total revenue is large due to the various changes society has taken over the recent years. The amount of money fluctuating in the U.S. has increased, leading to more money in the education system to help the success of the students. 

###Who Did What?

###Comparison to Lab 2
Team:

Richard:

Erin:

Jasmine:

Adam:
